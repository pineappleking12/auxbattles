<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aux Battles - Game Lobby</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <h1>Game Lobby</h1>
    <div id="roomCodeDisplay">Room Code: <span id="roomCode"></span></div>
    <button id="leaveBtn">Leave</button>
    
    <div class="game-sections">
      <div id="chatSection">
        <h2>Chat</h2>
        <div id="chatBox"></div>
        <input type="text" id="messageInput" placeholder="Type a message">
        <button id="sendMessageBtn">Send</button>
      </div>

      <div id="readySection">
        <h2>Players</h2>
        <ul id="playersList"></ul>
        <button id="toggleReadyBtn">Toggle Ready</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const roomCode = window.location.pathname.split('/')[1];
    const username = localStorage.getItem('username');
    
    // Display room code on page
    document.getElementById('roomCode').innerText = roomCode;

    // Join game logic
    socket.emit('joinGame', { gameCode: roomCode, username });

    // Handle chat messages
    document.getElementById('sendMessageBtn').addEventListener('click', () => {
      const message = document.getElementById('messageInput').value;
      socket.emit('sendMessage', { gameCode: roomCode, message });
    });

    socket.on('chatMessage', (message) => {
      const chatBox = document.getElementById('chatBox');
      chatBox.innerHTML += `<p>${message}</p>`;
    });

    // Handle ready state toggle
    document.getElementById('toggleReadyBtn').addEventListener('click', () => {
      socket.emit('toggleReady', { gameCode: roomCode, username, ready: true });
    });

    // Update players list with ready state and host indication
    socket.on('playerUpdate', (players) => {
      const playersList = document.getElementById('playersList');
      playersList.innerHTML = '';
      players.forEach(player => {
        const li = document.createElement('li');
        li.innerText = `${player.username} ${player.ready ? '(Ready)' : '(Not Ready)'} ${player.isHost ? '(Host)' : ''}`;
        playersList.appendChild(li);
      });
    });

    // Leave game logic
    document.getElementById('leaveBtn').addEventListener('click', () => {
      socket.emit('leaveGame', { gameCode: roomCode, username });
      window.location.href = '/';
    });

    // Notify when a player leaves
    socket.on('playerLeft', (username) => {
      const chatBox = document.getElementById('chatBox');
      chatBox.innerHTML += `<p>${username} has left the game.</p>`;
    });
  </script>
</body>
</html>
